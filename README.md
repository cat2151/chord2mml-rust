# chord2mml-rust

<p align="left">
  <a href="README.ja.md"><img src="https://img.shields.io/badge/ðŸ‡¯ðŸ‡µ-Japanese-red.svg" alt="Japanese"></a>
  <a href="README.md"><img src="https://img.shields.io/badge/ðŸ‡ºðŸ‡¸-English-blue.svg" alt="English"></a>
</p>

A library and application for converting chord progressions to MML (Music Macro Language), written in Rust.

## Note
- WIP
- Frequent breaking changes
- Progressing with AI autonomy to minimize user workload
- Intending to develop an AI autonomous system for this purpose (or rather, using this as a repository for AI autonomous system development)
- The following content is largely AI-generated, likely to contain errors, and may not align with user intent.

## Overview

This project is a complete rewrite of [chord2mml](https://github.com/cat2151/chord2mml), originally built with Peggy.js + JavaScript, now reimagined as **Rust + Tree-sitter**.

### Key Features

- **Tree-sitter Parser**: Robust and accurate syntax parsing
- **CSTâ†’AST Conversion**: Transforms CST (Concrete Syntax Tree) generated by Tree-sitter into AST (Abstract Syntax Tree)
- **Pure Rust Native Application**: Specialized in text-to-text conversion
- **CLI Tool**: Directly usable from the command line
- **Library Crate**: Directly usable from Rust native applications

## Architecture

```
chord2mml-rust/
â”œâ”€â”€ tree-sitter-chord/   # Tree-sitter Grammar Definition
â”œâ”€â”€ chord2mml-core/      # Rust Conversion Core Library (CSTâ†’ASTâ†’MML)
â””â”€â”€ chord2mml-cli/       # Command-Line Interface
```

### Data Flow

```
Input Text (e.g., "C-F-G-C")
    â†“
Tree-sitter Parser
    â†“
CST (Concrete Syntax Tree)
    â†“
AST Conversion
    â†“
AST (Abstract Syntax Tree)
    â†“
MML Generation
    â†“
Output MML (e.g., "'c;e;g' 'f;a;c' 'g;b;d' 'c;e;g'")
```

### Components

1. **tree-sitter-chord**: Tree-sitter Grammar Definition
   - Syntax definition for chord notation (e.g., C, Dm, G7)
   - Support for chord progressions (e.g., C-F-G-C)

2. **chord2mml-core**: A Rust library for parsing chord progressions and converting them to MML
   - Syntax analysis with Tree-sitter
   - Conversion from CST (Concrete Syntax Tree) to AST (Abstract Syntax Tree)
   - Conversion from AST to MML
   - Usable from native applications

3. **chord2mml-cli**: Command-Line Tool
   - Text-to-text conversion interface
   - Supports input from standard input/arguments

## Demo

### CLI Tool

```bash
# Single chord
$ chord2mml "C"
'c;e;g'

# Chord progression
$ chord2mml "C-F-G-C"
'c;e;g' 'f;a;c' 'g;b;d' 'c;e;g'

# Minor chord
$ chord2mml "Dm"
'd;f;a'

# Mixed progression
$ chord2mml "C-Dm-G-C"
'c;e;g' 'd;f;a' 'g;b;d' 'c;e;g'
```

## Usage

### CLI Tool

```bash
# Build
cd chord2mml-cli
cargo build --release

# Run (from arguments)
chord2mml "C-F-G-C"

# Run (from standard input)
echo "C-F-G-C" | chord2mml

# Interactive mode
chord2mml
# Enter chord notation and press Enter
```

### As a Rust Library

```rust
use chord2mml_core::convert;

fn main() {
    // Single chord
    let chord = "C";
    let mml = convert(chord).unwrap();
    println!("MML: {}", mml); // "'c;e;g'"
    
    // Chord progression
    let progression = "C-F-G-C";
    let mml = convert(progression).unwrap();
    println!("MML: {}", mml); // "'c;e;g' 'f;a;c' 'g;b;d' 'c;e;g'"
}
```

### Build Instructions

#### Rust Library and Core

```bash
cd chord2mml-core
cargo build --release
cargo test
```

#### CLI Tool

```bash
cd chord2mml-cli
cargo build --release
# The binary will be generated at ../target/release/chord2mml
```

#### Running Examples

```bash
cd chord2mml-core
cargo run --example basic
```

## Roadmap

### Phase 1: Basic Tree-sitter based implementation âœ…

- [x] Define Tree-sitter grammar
- [x] Basic chord conversion functionality (C â†’ c;e;g)
- [x] Support for chord progressions (C-F-G-C)
- [x] CSTâ†’ASTâ†’MML conversion pipeline
- [x] Implement CLI tool
- [x] Add comprehensive tests

### Phase 2: Porting original chord2mml tests

Port tests from the original [chord2mml](https://github.com/cat2151/chord2mml) repository, covering the following chords:

**Current Implementation Status**: Major and minor chords are fully implemented. Other chord types are currently only recognized by the parser, with MML conversion yet to be implemented.

#### Major Chords
- [x] C (C-E-G)
- [ ] C6 (C-E-G-A)
- [ ] CM7, Cmaj7 (C-E-G-B) *Parser only, MML conversion not yet implemented*
- [ ] Cadd9 (C-E-G-D)

#### Minor Chords
- [x] Cm (C-Eâ™­-G)
- [ ] Cm7 (C-Eâ™­-G-Bâ™­)

#### Seventh Chords
- [ ] C7 (C-E-G-Bâ™­) *Parser only, MML conversion not yet implemented*
- [ ] C7sus4 (C-F-G-Bâ™­)

#### Diminished and Augmented Chords
- [ ] Cdim (C-Eâ™­-Gâ™­) *Parser only, MML conversion not yet implemented*
- [ ] Caug, C+, C(#5) (C-E-G#) *Parser only, MML conversion not yet implemented*

#### Suspend Chords
- [ ] Csus4 (C-F-G) *Parser only, MML conversion not yet implemented*
- [ ] Csus2 (C-D-G) *Parser only, MML conversion not yet implemented*

#### Inversions and Bass Designations
- [ ] C/E (First inversion: E-G-C) *Parser only, MML conversion not yet implemented*
- [ ] C/G (Second inversion: G-C-E) *Parser only, MML conversion not yet implemented*
- [ ] C/D (On-chord: D-C-E-G) *Parser only, MML conversion not yet implemented*

#### Feature Enhancements
- [ ] Octave specification
- [ ] Rhythm and note length specification
- [x] Continuous input of multiple chords (chord progressions)

### Phase 3: Advanced Features and Integration

- [ ] Support for more complex chord progressions
- [ ] Full implementation of all chord types
- [ ] Re-implementation of WASM support (if necessary)
- [ ] Performance improvements
- [ ] Enhanced error handling
- [ ] Documentation improvement

## Development Approach

### Differences from Original chord2mml

| Aspect             | chord2mml (Old)     | chord2mml-rust (New)     |
|--------------------|---------------------|--------------------------|
| Parser             | Peggy.js            | Tree-sitter              |
| Language           | JavaScript/TypeScript | Rust                     |
| Runtime Environment| Browser-only        | Native (CLI)             |
| Conversion Flow    | PEG â†’ AST â†’ MML     | Tree-sitter â†’ CST â†’ AST â†’ MML |
| Library Usage      | Difficult           | Easy (Rust Crate)        |

### Design Philosophy

1. **Simplicity**: Avoid complexity, prioritize maintainability
2. **Type Safety**: Leverage Rust's powerful type system
3. **Test-Driven**: Comprehensive test coverage
4. **Performance**: Fast conversions utilizing Rust's speed

## Target Platforms

- **Rust Library**: All Rust-supported environments
- **CLI Tool**: Linux, macOS, Windows

## Technology Stack

- **Rust**: 1.70 or later
- **Tree-sitter**: Parsing engine
- **tree-sitter-cli**: Grammar generation tool

## Testing

```bash
# Test Rust core
cd chord2mml-core
cargo test

# Test all
cargo test --all

# Run examples
cd chord2mml-core
cargo run --example basic
```

## Build Requirements

- Rust 1.70 or later
- Node.js 18 or later (for tree-sitter-cli)
- tree-sitter-cli (for grammar generation)

## License

MIT License

## Related Projects

- [chord2mml](https://github.com/cat2151/chord2mml) - Original JavaScript version
- [tonejs-mml-to-json](https://github.com/cat2151/tonejs-mml-to-json) - MML parsing library
- [tonejs-json-sequencer](https://github.com/cat2151/tonejs-json-sequencer) - Audio playback library

## Contributing

Issues and Pull Requests are welcome.

## Author

cat2151

## Reference Links

- [Original chord2mml](https://github.com/cat2151/chord2mml) - Original JavaScript version
- [Tree-sitter](https://tree-sitter.github.io/tree-sitter/) - Parsing library
- [EXAMPLES.md](EXAMPLES.md) - More detailed usage examples and architecture description